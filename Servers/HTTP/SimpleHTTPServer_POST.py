import SimpleHTTPServer
import SocketServer
import sys
import time

"""
Python script built on SimpleHTTPServer for handling POST Requests

Original script:
https://gist.github.com/kylemcdonald/3bb71e4b901c54073cbc
"""

def usage():
    print "[!] Usage: python SimpleHTTPServer_POST.py <PORT>"
    exit(0)

if len(sys.argv) == 1:
    PORT = 8000
elif len(sys.argv) == 2:
    try:
        PORT = int(sys.argv[1])
    except ValueError:
        print "[!] PORT parameter needs to be an integer!"
        usage()
else:
    usage()


class ServerHandler(SimpleHTTPServer.SimpleHTTPRequestHandler):

    def do_POST(self):
        content_len = int(self.headers.getheader('content-length', 0))
        post_body = self.rfile.read(content_len)

        print self.rfile

        fileName = "./file_"
        fileName += str(time.time())
        fileName += ".dat"

        with open(fileName, "w") as file:
            file.write(post_body)

        print "[POST] - File received!"


Handler = ServerHandler

httpd = SocketServer.TCPServer(("", PORT), Handler)

print "[*] Serving HTTP on 0.0.0.0 port", PORT
httpd.serve_forever()
